<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interactive To‑Do List</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f8fafc; }
    .task { transition: background .15s ease, transform .12s ease; }
    .task:hover { transform: translateY(-2px); }
    /* Style for completed tasks */
    .task.completed .task-text { text-decoration: line-through; opacity: .6; }
    .task.completed { background: #e9ecef; }
    .no-tasks { color: #6b7280; }
  </style>
</head>
<body>
  <main class="container py-5">
    <div class="row justify-content-center">
      <div class="col-12 col-md-10 col-lg-8">
        <div class="card shadow-sm">
          <div class="card-body">
            <h3 class="card-title mb-3">Interactive To‑Do List</h3>

            <!-- Add task form -->
            <form id="taskForm" class="mb-3">
              <div class="input-group">
                <input id="taskInput" type="text" class="form-control" placeholder="Add a new task..." aria-label="New task">
                <button class="btn btn-primary" type="submit">Add</button>
              </div>
            </form>

            <!-- Controls -->
            <div class="d-flex justify-content-between align-items-center mb-3 gap-2">
              <div>
                <button id="clearCompleted" class="btn btn-outline-danger btn-sm">Clear completed</button>
                <button id="clearAll" class="btn btn-outline-secondary btn-sm">Clear all</button>
              </div>
              <div class="text-muted small">Press <kbd>Enter</kbd> to add</div>
            </div>

            <!-- Task list -->
            <div id="tasks" class="list-group"></div>

            <div id="emptyState" class="mt-3 text-center no-tasks" style="display:none;">No tasks yet — add one above.</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Elements
    const taskForm = document.getElementById('taskForm');
    const taskInput = document.getElementById('taskInput');
    const tasksEl = document.getElementById('tasks');
    const emptyState = document.getElementById('emptyState');
    const clearCompletedBtn = document.getElementById('clearCompleted');
    const clearAllBtn = document.getElementById('clearAll');

    // Key for localStorage
    const STORAGE_KEY = 'todo_tasks_v1';

    // In-memory tasks array: {id, text, done}
    let tasks = [];

    // Initialize
    loadTasks();
    renderTasks();

    // Form submit (add task)
    taskForm.addEventListener('submit', e => {
      e.preventDefault();
      const text = taskInput.value.trim();
      if (!text) return;
      const task = { id: Date.now().toString(), text, done: false };
      tasks.unshift(task); // newest on top
      saveTasks();
      renderTasks();
      taskInput.value = '';
      taskInput.focus();
    });

    // Event delegation for task actions (toggle, delete)
    tasksEl.addEventListener('click', e => {
      const li = e.target.closest('.list-group-item');
      if (!li) return;
      const id = li.dataset.id;

      // Toggle checkbox
      if (e.target.matches('input[type="checkbox"]')) {
        toggleTask(id);
        return;
      }

      // Delete button
      if (e.target.matches('.btn-delete')) {
        removeTask(id);
        return;
      }
    });

    // Clear completed
    clearCompletedBtn.addEventListener('click', () => {
      tasks = tasks.filter(t => !t.done);
      saveTasks();
      renderTasks();
    });

    // Clear all
    clearAllBtn.addEventListener('click', () => {
      if (!confirm('Clear ALL tasks? This cannot be undone.')) return;
      tasks = [];
      saveTasks();
      renderTasks();
    });

    // Toggle task done state
    function toggleTask(id) {
      tasks = tasks.map(t => t.id === id ? { ...t, done: !t.done } : t);
      saveTasks();
      renderTasks();
    }

    // Remove task by id
    function removeTask(id) {
      tasks = tasks.filter(t => t.id !== id);
      saveTasks();
      renderTasks();
    }

    // Render tasks list
    function renderTasks() {
      tasksEl.innerHTML = '';
      if (tasks.length === 0) {
        emptyState.style.display = 'block';
        return;
      }
      emptyState.style.display = 'none';

      // Use DocumentFragment for performance
      const frag = document.createDocumentFragment();

      tasks.forEach(task => {
        const item = document.createElement('div');
        item.className = 'list-group-item d-flex align-items-center gap-3 task';
        if (task.done) item.classList.add('completed');
        item.dataset.id = task.id;

        item.innerHTML = `
          <div class="form-check">
            <input class="form-check-input" type="checkbox" ${task.done ? 'checked' : ''} id="chk-${task.id}">
          </div>
          <div class="flex-grow-1">
            <div class="task-text">${escapeHtml(task.text)}</div>
          </div>
          <div>
            <button class="btn btn-sm btn-outline-danger btn-delete" title="Remove">Remove</button>
          </div>
        `;

        frag.appendChild(item);
      });

      tasksEl.appendChild(frag);
    }

    // Save to localStorage
    function saveTasks() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
      } catch (e) {
        console.error('Could not save tasks', e);
      }
    }

    // Load from localStorage
    function loadTasks() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return tasks = [];
        tasks = JSON.parse(raw) || [];
      } catch (e) {
        console.error('Could not load tasks', e);
        tasks = [];
      }
    }

    // Small helper to avoid HTML injection
    function escapeHtml(str) {
      return str.replace(/[&<>\"']/g, function (c) {
        return ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c];
      });
    }

    // Accessibility: focus input on load
    window.addEventListener('load', () => taskInput.focus());
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
